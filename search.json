[{"path":"https://changsubiostats.github.io/scMultiMap/LICENSE.html","id":null,"dir":"","previous_headings":"","what":"MIT License","title":"MIT License","text":"Copyright (c) 2024 scMultiMap authors Permission hereby granted, free charge, person obtaining copy software associated documentation files (“Software”), deal Software without restriction, including without limitation rights use, copy, modify, merge, publish, distribute, sublicense, /sell copies Software, permit persons Software furnished , subject following conditions: copyright notice permission notice shall included copies substantial portions Software. SOFTWARE PROVIDED “”, WITHOUT WARRANTY KIND, EXPRESS IMPLIED, INCLUDING LIMITED WARRANTIES MERCHANTABILITY, FITNESS PARTICULAR PURPOSE NONINFRINGEMENT. EVENT SHALL AUTHORS COPYRIGHT HOLDERS LIABLE CLAIM, DAMAGES LIABILITY, WHETHER ACTION CONTRACT, TORT OTHERWISE, ARISING , CONNECTION SOFTWARE USE DEALINGS SOFTWARE.","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/articles/GWAS.html","id":"motivation","dir":"Articles","previous_headings":"","what":"Motivation","title":"scMultiMap for integrative analysis with GWAS results","text":"75 genetic loci associated risk developing Alzheimer’s disease (AD) (Bellenguez, C. et al.), yet regulatory functions relevant cellular contexts remain unclear. Among brain cell types, microglia—brain’s innate immune cells—exhibit highest enrichment genetic association AD cis-regulatory elements (Nott, . et al., Gjoneska, E. et al.). Therefore, analysis focuses microglia uses scMultiMap identify candidate pairs cis-regulatory elements target genes. two examples, examine scMultiMap results can elucidate regulatory function fine-mapped AD variants microglia two loci: PICALM INPP5D.","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/articles/GWAS.html","id":"run-scmultimap","dir":"Articles","previous_headings":"","what":"Run scMultiMap","title":"scMultiMap for integrative analysis with GWAS results","text":"Note: vignette use dataset vignette: scMultiMap disease-control studies. Please refer details pre-processing data running scMultiMap. analysis, study top 5000 highly expressed genes top 50000 highly accessible peaks microglia, use cis-region width 1Mb define candidate peak-gene pairs. , generated 135401 candidate peak-gene pairs based criterion . users can also customize peak-gene pairs based analysis goal. Next, estimate peak-gene associations microglia control Alzheimer’s disease groups, respectively. Note multiple biological samples dataset, scMultiMap run bsample avoid spurious associations due heterogeneity across biological samples (see Methods scMultiMap’s manuscript details). warning suggests peaks genes variance estimated negative, causing numerical errors calculating correlations. situation typically rare may happen consider genes peaks extremely low abundance (e.g. top 5000 genes top 50000 peaks ). estimated correlations internally set 0 scMultiMap.","code":"# set it to the directory where data are saved data_dir <- '../../../data'   # load AD Multiome data obj <- readRDS(sprintf('%s/processed_AD_DLPFC_15.rds', data_dir)) # subset to microglia ct <- 'Microglia' ct_obj <- subset(x = obj, subset = predicted.id == ct) pairs_df <- get_top_peak_gene_pairs(ct_control,                                     gene_top=5000, peak_top=50000,                                     distance = 5e+5,                                     gene_assay = 'RNA', # name of the gene assay                                     peak_assay = 'peaks') # name of the peak assay # In the paper, we used control microglia to define peak-gene pairs. (`ct_control`) # One can also use all microglia. # multiple biological samples table(ct_obj$id) #>  #>     1224     1230     1238     3329     3586     4305     4313     4443  #>      201      161      283      211      152      347       17      171  #>     4481     4482     4627 HCT17HEX   HCTZZT   NT1261   NT1271  #>      233      415      241      264       26      192      265 # control control_res <- scMultiMap(ct_control,                            pairs_df,                           bsample = 'id',                           gene_assay = 'RNA',                           peak_assay = 'peaks') #> Start step 1: IRLS #> Start IRLS for RNA #> Start IRLS for peaks #> Start step 2: WLS #> There are 4652 unique genes in the peak-gene pairs. #> Warning in sqrt(deno): NaNs produced #> scMultiMap elapsed time: 01:13 (mm:ss)  # disease disease_res <- scMultiMap(ct_AD,                            pairs_df,                           bsample = 'id',                           gene_assay = 'RNA',                           peak_assay = 'peaks') #> Start step 1: IRLS #> Start IRLS for RNA #> Start IRLS for peaks #> Start step 2: WLS #> There are 4652 unique genes in the peak-gene pairs. #> scMultiMap elapsed time: 01:16 (mm:ss)"},{"path":"https://changsubiostats.github.io/scMultiMap/articles/GWAS.html","id":"load-results-on-fine-mapped-ad-gwas-variants","dir":"Articles","previous_headings":"","what":"Load results on fine-mapped AD GWAS variants","title":"scMultiMap for integrative analysis with GWAS results","text":"","code":"# AD GWAS variants fine-mapped and priortized based on eQTL & Hi-C # \"Seeding from PAINTOR or FGWAS 95% credible set variants (Sup- plementary Table 6b),  # we first included their linkage disequilibrium (LD) tags (defined as LD R2 > 0.8) in TOP-LD European (EUR)  # and then retained only those overlapping microglia ATAC–seq peaks that interact with promoters\" # # Reference: https://www.nature.com/articles/s41588-023-01506-8 # Data source: supplementary table 6b  mic_fm_prior_variants_df <- read.xlsx(sprintf('%s/41588_2023_1506_MOESM3_ESM.xlsx', data_dir),                                 sheet = 'Supplementary Table 6c', startRow = 2) mic_fm_prior_variants_df$chr <- paste0('chr', mic_fm_prior_variants_df$chr) grange_mic_fm_prior <- GenomicRanges::makeGRangesFromDataFrame(df = mic_fm_prior_variants_df,                                                           seqnames.field = 'chr',                                                          start.field = 'pos.hg38',                                                          end.field = 'pos.hg38')"},{"path":[]},{"path":"https://changsubiostats.github.io/scMultiMap/articles/GWAS.html","id":"picalm-locus-figure-4d","dir":"Articles","previous_headings":"Visualize inferred peak-gene links and fine-mapped GWAS variants","what":"PICALM locus (figure 4d)","title":"scMultiMap for integrative analysis with GWAS results","text":"reproduced Figure~4d scMultiMap’s manuscript.","code":"# make grange objects that connect genes with peaks gene_peak_link_gr_control <- make_gene_to_peak_link(control_res, 'PICALM', ct_control, 'peaks') gene_peak_link_gr_AD <- make_gene_to_peak_link(disease_res, 'PICALM', ct_AD, 'peaks') gene_peak_link_list <- list(AD = gene_peak_link_gr_AD, control = gene_peak_link_gr_control) uniform_fs <- 20 # genomic region around PICALM locus selected_range <- \"chr11-85850000-86216290\"  gene_plot <- AnnotationPlot(   object = ct_control,   region = selected_range ) + theme(text = element_text(size = uniform_fs))   link_plot_list <- list() for(g in c('control','AD')){     Links(ct_obj) <- gene_peak_link_list[[g]][abs(gene_peak_link_list[[g]]$score) > 0.2]     link_plot_list[[g]] <- LinkPlot(         object = ct_obj,         region = selected_range     ) + scale_color_gradient2(low = \"blue\",                               midpoint = 0,                               mid = \"white\",                               high = \"red\",                               space=\"Lab\",                              limits = c(-1,1)) +     labs(color = 'correlation', y = sprintf('%s', g)) +     theme(text = element_text(size = uniform_fs)) } #> Scale for colour is already present. #> Adding another scale for colour, which will replace the existing scale. #> Scale for colour is already present. #> Adding another scale for colour, which will replace the existing scale. expr_plot <- ExpressionPlot(   object = ct_obj,   features = \"PICALM\",   assay = \"SCT\",     group.by='Status' )  + theme(text = element_text(size = uniform_fs))  # to see it on the plot end(grange_mic_fm_prior) <- end(grange_mic_fm_prior) + 1000  DefaultAssay(ct_obj) <- 'peaks' snp_plot <- PeakPlot(   ct_obj,   selected_range,   assay = NULL,   peaks = grange_mic_fm_prior,   group.by = NULL,   color = \"black\",   sep = c(\"-\", \"-\") ) + labs(y = 'SNPs') +     theme(text = element_text(size = uniform_fs)) g <- CombineTracks(plotlist = list(gene_plot, snp_plot, link_plot_list[[1]], link_plot_list[[2]]),                    expression.plot = expr_plot,                    heights = c(2,1,2,2) * 5/7,                    widths = c(6.5, 1)) g"},{"path":"https://changsubiostats.github.io/scMultiMap/articles/GWAS.html","id":"inpp5d-locus-figure-4e","dir":"Articles","previous_headings":"Visualize inferred peak-gene links and fine-mapped GWAS variants","what":"INPP5D locus (figure 4e)","title":"scMultiMap for integrative analysis with GWAS results","text":"Repeat analysis INPP5D locus.  reproduced Figure~4e scMultiMap’s manuscript.","code":"# make grange objects that connect genes with peaks gene_peak_link_gr_control <- make_gene_to_peak_link(control_res, 'INPP5D', ct_control, 'peaks') gene_peak_link_gr_AD <- make_gene_to_peak_link(disease_res, 'INPP5D', ct_AD, 'peaks') gene_peak_link_list <- list(AD = gene_peak_link_gr_AD, control = gene_peak_link_gr_control) uniform_fs <- 20 # genomic region around INPP5D locus selected_range <- \"chr2-232850000-233259353\"  gene_plot <- AnnotationPlot(   object = ct_control,   region = selected_range ) + theme(text = element_text(size = uniform_fs))   link_plot_list <- list() for(g in c('control','AD')){     Links(ct_obj) <- gene_peak_link_list[[g]][abs(gene_peak_link_list[[g]]$score) > 0.2]     link_plot_list[[g]] <- LinkPlot(         object = ct_obj,         region = selected_range     ) + scale_color_gradient2(low = \"blue\",                               midpoint = 0,                               mid = \"white\",                               high = \"red\",                               space=\"Lab\",                              limits = c(-1,1)) +     labs(color = 'correlation', y = sprintf('%s', g)) +     theme(text = element_text(size = uniform_fs)) } #> Scale for colour is already present. #> Adding another scale for colour, which will replace the existing scale. #> Scale for colour is already present. #> Adding another scale for colour, which will replace the existing scale. expr_plot <- ExpressionPlot(   object = ct_obj,   features = \"INPP5D\",   assay = \"SCT\",     group.by='Status' )  + theme(text = element_text(size = uniform_fs))  # to see it on the plot end(grange_mic_fm_prior) <- end(grange_mic_fm_prior) + 1000  DefaultAssay(ct_obj) <- 'peaks' snp_plot <- PeakPlot(   ct_obj,   selected_range,   assay = NULL,   peaks = grange_mic_fm_prior,   group.by = NULL,   color = \"black\",   sep = c(\"-\", \"-\") ) + labs(y = 'SNPs') +     theme(text = element_text(size = uniform_fs)) g <- CombineTracks(plotlist = list(gene_plot, snp_plot, link_plot_list[[1]], link_plot_list[[2]]),                    expression.plot = expr_plot,                    heights = c(2,1,2,2) * 5/7,                    widths = c(6.5, 1)) g"},{"path":"https://changsubiostats.github.io/scMultiMap/articles/disease_control.html","id":"load-pre-processed-data","dir":"Articles","previous_headings":"","what":"1. Load pre-processed data","title":"scMultiMap for disease-control studies","text":"downloaded single-cell Multiome data brain Alzheimer’s disease study Anderson et al., dataset used manuscript (GSE214979). re-called peaks cell types MACS2 using codes scMultiMap reproducibility Github repo. Calling peaks cell types generates cell-type-specific peaks better represent candidate cell-type-specific enhancers identified cell types merged, may obscure signals less abundant cell types microglia. Using MACS2 provides fragment counts required running scMultiMap (see discussion ). analysis, study top 5000 highly expressed genes top 50000 highly accessible peaks microglia, use cis-region width 1Mb define candidate peak-gene pairs. , generated 135401 candidate peak-gene pairs based criterion . users can also customize peak-gene pairs based analysis goal.","code":"# set it to the directory where data are saved data_dir <- '../../../data'   # load AD Multiome data obj <- readRDS(sprintf('%s/processed_AD_DLPFC_15.rds', data_dir)) # subset to microglia ct <- 'Microglia' ct_obj <- subset(x = obj, subset = predicted.id == ct) pairs_df <- get_top_peak_gene_pairs(subset(x = ct_obj, subset = Diagnosis == 'Unaffected'),                                     gene_top=5000, peak_top=50000,                                     distance = 5e+5,                                     gene_assay = 'RNA', # name of the gene assay                                     peak_assay = 'peaks') # name of the peak assay # In the paper, we used control microglia to define peak-gene pairs. (`ct_control`) # One can also use all microglia."},{"path":"https://changsubiostats.github.io/scMultiMap/articles/disease_control.html","id":"differential-association-analysis","dir":"Articles","previous_headings":"","what":"3. Differential association analysis","title":"scMultiMap for disease-control studies","text":"Next, estimate peak-gene associations microglia control Alzheimer’s disease groups, respectively. Note multiple biological samples group, scMultiMap run bsample avoid spurious associations due heterogeneity across biological samples (see Methods scMultiMap’s manuscript details). difference two estimates (‘observed difference’) represents magnitude differential association. assess statistical significance, use permutation test randomly reassigns sample labels disease control groups 100 times, generating null distribution difference groups (‘null difference’). generated permutation p-value evaluating proportion times “observed difference” larger magnitude “null difference”.","code":"# multiple biological samples table(ct_obj$id) #>  #>     1224     1230     1238     3329     3586     4305     4313     4443  #>      201      161      283      211      152      347       17      171  #>     4481     4482     4627 HCT17HEX   HCTZZT   NT1261   NT1271  #>      233      415      241      264       26      192      265 # control control_res <- scMultiMap(subset(x = ct_obj, subset = Diagnosis == 'Unaffected'),                            pairs_df,                           bsample = 'id', # labels for biological samples in the Seurat object                           gene_assay = 'RNA', # name of the gene assay                           peak_assay = 'peaks') # name of the peak assay #> Start step 1: IRLS #> Start IRLS for RNA #> Start IRLS for peaks #> Start step 2: WLS #> There are 4652 unique genes in the peak-gene pairs. #> Warning in sqrt(deno): NaNs produced #> scMultiMap elapsed time: 01:11 (mm:ss)  # disease disease_res <- scMultiMap(subset(x = ct_obj, subset = Diagnosis == \"Alzheimer's\"),                            pairs_df,                           bsample = 'id',                           gene_assay = 'RNA',                           peak_assay = 'peaks') #> Start step 1: IRLS #> Start IRLS for RNA #> Start IRLS for peaks #> Start step 2: WLS #> There are 4652 unique genes in the peak-gene pairs. #> scMultiMap elapsed time: 01:15 (mm:ss) # obtain the status for each id (sample) Status_id_tab <- table(ct_obj$id, ct_obj$Status) Status_id_tab #>            #>             AD Ctrl #>   1224       0  201 #>   1230       0  161 #>   1238       0  283 #>   3329     211    0 #>   3586       0  152 #>   4305     347    0 #>   4313      17    0 #>   4443     171    0 #>   4481     233    0 #>   4482     415    0 #>   4627     241    0 #>   HCT17HEX   0  264 #>   HCTZZT     0   26 #>   NT1261     0  192 #>   NT1271     0  265 Status_ids <- lapply(1:2, function(i) rownames(Status_id_tab)[Status_id_tab[,i] > 0])  all_comb <- combn(rownames(Status_id_tab), length(Status_ids[[1]])) set.seed(2024) n_permu <- 100 # randomly reassign 7 samples to the AD group random_combs <- sample(1:ncol(all_comb), n_permu, replace = F) diff_mat <- matrix(nrow = nrow(control_res), ncol = n_permu) for(i_permu in 1:n_permu){   # obtain randomly shuffled sample labels   disease_sams <- all_comb[,random_combs[i_permu]]   control_sams <- rownames(Status_id_tab)[!rownames(Status_id_tab) %in% disease_sams]   # control   null_control <- scMultiMap(subset(x = ct_obj, subset = id %in% control_sams),                               pairs_df,                              bsample = 'id',                              gene_assay = 'RNA',                              peak_assay = 'peaks')    # disease   null_disease <- scMultiMap(subset(x = ct_obj, subset = id %in% disease_sams),                               pairs_df,                              bsample = 'id',                              gene_assay = 'RNA',                              peak_assay = 'peaks')    # null difference, i_permu   diff_mat[,i_permu] <- null_disease[,'covar'] - null_control[,'covar']   message(i_permu) } obs_diff <- disease_res[,'covar'] - control_res[,'covar'] pval1 <- rowMeans(obs_diff > diff_mat) pval2 <- rowMeans(obs_diff < diff_mat) permu_pval <- pmin(pval1, pval2) * 2 par(cex = 1.5) hist(permu_pval, main = 'Permutation p-values', breaks = 10)"},{"path":[]},{"path":"https://changsubiostats.github.io/scMultiMap/articles/disease_control.html","id":"enrichment-of-differentially-expressed-genes","dir":"Articles","previous_headings":"4. Downstream analysis of differentially associated peak-gene pairs","what":"Enrichment of differentially expressed genes","title":"scMultiMap for disease-control studies","text":"assess genes differential association enriched differential expression. Comparing AD DEGs results Mathys et al. Anderson et al., genes differential assocations peaks microglia significantly enriched microglia DEGs odds ratio 1.56 1.48, respectively.","code":"# microglia DEG from Supplementary table 9 of https://www.nature.com/articles/s41586-024-07606-7 DEG <- read.table(sprintf('%s/aggregated_fullset.Mic_Immune_Mic.tsv.gz', data_dir), header = T) DEG <- DEG[DEG$region == 'PFC',] DEG <- DEG[DEG$log10p_nm > -log10(0.05/nrow(DEG)),] DEG_inds <- control_res$gene %in% DEG$gene  # evaluate enrichment of differentially expressed genes among genes from differentially associated peak-gene pairs total_gene <- unique(control_res$gene) DEG_gene <- unique(control_res$gene[DEG_inds]) sig_gene <- unique(control_res$gene[permu_pval < 0.05]) # genes in differentially associated peak-gene pairs (p-value < 0.05) tab1 <- table(total_gene %in% DEG_gene, total_gene %in% sig_gene) fisher.test(tab1, alternative = 'greater') #>  #>  Fisher's Exact Test for Count Data #>  #> data:  tab1 #> p-value = 6.035e-06 #> alternative hypothesis: true odds ratio is greater than 1 #> 95 percent confidence interval: #>  1.308737      Inf #> sample estimates: #> odds ratio  #>   1.556541 # another set of microglia DEG from supplementary table of https://pmc.ncbi.nlm.nih.gov/articles/PMC10025452/ # wget https://ars.els-cdn.com/content/image/1-s2.0-S2666979X23000198-mmc4.xls DEG <- read.xlsx(sprintf('%s/1-s2.0-S2666979X23000198-mmc4.xlsx', data_dir), sheet = 'TableS3_ADCtrl_DEGs') DEG_inds <- control_res$gene %in% DEG$gene[DEG$celltype == 'Microglia']  # evaluate enrichment of differentially expressed genes among genes from differentially associated peak-gene pairs total_gene <- unique(control_res$gene) DEG_gene <- unique(control_res$gene[DEG_inds]) sig_gene <- unique(control_res$gene[permu_pval < 0.05]) # genes in differentially associated peak-gene pairs (p-value < 0.05) tab2 <- table(total_gene %in% DEG_gene, total_gene %in% sig_gene) fisher.test(tab2, alternative = 'greater') #>  #>  Fisher's Exact Test for Count Data #>  #> data:  tab2 #> p-value = 0.01361 #> alternative hypothesis: true odds ratio is greater than 1 #> 95 percent confidence interval: #>  1.097925      Inf #> sample estimates: #> odds ratio  #>   1.482689"},{"path":"https://changsubiostats.github.io/scMultiMap/articles/disease_control.html","id":"visualization","dir":"Articles","previous_headings":"4. Downstream analysis of differentially associated peak-gene pairs","what":"Visualization","title":"scMultiMap for disease-control studies","text":"visualize associations control versus disease groups. focus peak-gene pairs (1) significantlly differentially associated (nominal p-value < 0.05); (2) significantlly associated either control AD microglia (p-value < 0.05); (3) difference correlation greater 0.2.  reproduced Figure~4b scMultiMap’s manuscript. differentially associated peak-gene pairs can analyzed GWAS (Genome-wide association studies) results, elucidate cell-type-specific regulatory mechanisms GWAS variant disease relevant cell types. Please see scMultiMap integrative analysis GWAS results, separate vignette uses differentially associated peak-gene pairs identified investigate function causal variants Alzheimer’s disease microglia.","code":"subset_inds <- (permu_pval < 0.05) &     (control_res$pval < 0.05 | disease_res$pval < 0.05) &     (abs(control_res$cor - disease_res$cor) > 0.2) coexp_mat <- cbind(control_res$cor, disease_res$cor) colnames(coexp_mat) <- c('control', 'AD') g <- pheatmap(t(coexp_mat[DEG_inds & subset_inds,]),             col = rev(brewer.pal(11, 'RdBu')),             cluster_rows = F, cluster_cols = T,             annotation_names_row = F,              annotation_names_col = F,             fontsize_row = 15,          # row label font size             fontsize_col = 7,          # column label font size              angle_col = 45, # sample names at an angle             legend_breaks = seq(-1,1,0.2), #c(-1, 0, 1), # legend customisation             show_colnames = F, show_rownames = T, # displaying column and row names             cellheight=50, treeheight_col = 15,             fontsize = 12)"},{"path":"https://changsubiostats.github.io/scMultiMap/articles/scMultiMap.html","id":"toy-example","dir":"Articles","previous_headings":"","what":"1. Toy example","title":"scMultiMap","text":"illustrate basic functionality scMultiMap, use toy Seurat object small_obj data frame candidate peak-gene pairs small_pairs_df provided R package run scMultiMap: example data, run scMultiMap: , scMultiMap takes Seurat object two modalities: RNA peak, evaluates associations 250 peak-gene pairs. assume Seurat object contains cells specific cell type interest, inferred associations cell-type-specific.","code":"# a Seurat object small_obj #> An object of class Seurat  #> 350 features across 100 samples within 2 assays  #> Active assay: RNA (100 features, 0 variable features) #>  1 layer present: counts #>  1 other assay present: peak  # candidate peak-gene pairs head(small_pairs_df) #>     gene                    peak #> 1 MALAT1 chr11-65013281-65014841 #> 2 MALAT1 chr11-65026934-65027962 #> 3 MALAT1 chr11-65040583-65041780 #> 4 MALAT1 chr11-65083457-65084665 #> 5 MALAT1 chr11-65095679-65096871 #> 6 MALAT1 chr11-65110172-65110785 dim(small_pairs_df) #> [1] 250   2 res <- scMultiMap(small_obj, small_pairs_df) # < 0.1 seconds #> Start step 1: IRLS #> Start IRLS for RNA #> Start IRLS for peak #> Start step 2: WLS #> There are 10 unique genes in the peak-gene pairs. #> scMultiMap elapsed time: 00:00 (mm:ss) head(res) #>     gene                    peak       pval  test_stat         covar      padj #> 1 MALAT1 chr11-65013281-65014841 0.15215553  1.4319591  3.100282e-05 0.8273097 #> 2 MALAT1 chr11-65026934-65027962 0.79384145  0.2613256  5.204042e-06 0.9753992 #> 3 MALAT1 chr11-65040583-65041780 0.68116942  0.4108679  8.623731e-06 0.9472305 #> 4 MALAT1 chr11-65083457-65084665 0.03236884  2.1398259  4.879823e-05 0.7196890 #> 5 MALAT1 chr11-65095679-65096871 0.02264609 -2.2793530 -4.308216e-05 0.7196890 #> 6 MALAT1 chr11-65110172-65110785 0.88810490 -0.1407026 -1.919029e-06 0.9881934 #>           cor #> 1  0.00000000 #> 2  0.10216095 #> 3  0.29533510 #> 4  0.62091902 #> 5 -0.57664094 #> 6 -0.08605519 dim(res) #> [1] 250   7"},{"path":[]},{"path":"https://changsubiostats.github.io/scMultiMap/articles/scMultiMap.html","id":"note-fragment-counts-are-required-for-scmultimap","dir":"Articles","previous_headings":"2. PBMC example, 10x Multiome data","what":"2.1 Note: fragment counts are required for scMultiMap","title":"scMultiMap","text":"demonstrating scMultiMap real data, highlight important requirement peak counts. discussed “Discussion” scMultiMap’s manuscript, scMultiMap designed model fragment counts, suitable count-based modeling improve downstream analysis performance compared insertion counts read counts (Miao Kim, 2024, Martens et al., 2024). Therefore, plan use scMultiMap, ensure scATAC-seq data consist fragment counts instead read counts. recommend using MACS2 peak calling, generates fragment counts (see Calling peaks). read counts access ATAC-seq fragment files, fragment counts can estimated following approach Martens et al., 2024. demonstrate , downloaded 10x Multiome dataset (paired scRNA-seq scATAC-seq) 10x, used MACS2 call peaks cell types, generated processed_seurat_obj_PBMC_10k.rds. source code steps can found scMultiMap reproducibility Github repo. Calling peak cell type generate cell-type-specific peaks better represent candidate cell-type-specific enhancers identified merged cell types.","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/articles/scMultiMap.html","id":"demo-of-scmultimap-on-cd14-monocytes","dir":"Articles","previous_headings":"2. PBMC example, 10x Multiome data","what":"2.2 Demo of scMultiMap on CD14 Monocytes","title":"scMultiMap","text":"choose study top 2000 highly expressed genes top 20000 highly accessible peaks CD14 Monocytes, use cis-region width 1Mb define candidate peak-gene pairs. , generated 32296 candidate peak-gene pairs generated based criterion . Generally, pairs studied also customized supplied users. Nect, run scMultiMap assess peak-gene associations. Running scMultiMap dataset took ~20-25 seconds using single core Intel(R) Xeon(R) Gold 6326 CPU @ 2.90GHz. . res dataframe association statistics p-values 32296 peak-gene pairs.","code":"# set it to the directory where data are saved data_dir <- '../../../data' pbmc <- readRDS(sprintf('%s/processed_seurat_obj_PBMC_10k_nextgem.rds', data_dir)) # in this example, we focus on CD14 monocytes: pbmc_cd14 <- subset(pbmc, predicted.id == 'CD14 Mono') print(pbmc_cd14) pairs_df <- get_top_peak_gene_pairs(pbmc_cd14,                                     gene_top=2000, peak_top=20000,                                     distance = 5e+5,                                     gene_assay = 'RNA', # name of the gene assay                                     peak_assay = 'peaks_ct') # name of the peak assay head(pairs_df) #>     gene                    peak #> 1 MALAT1 chr11-65614961-65616132 #> 2 MALAT1 chr11-65918502-65920142 #> 3 MALAT1 chr11-65856895-65858482 #> 4 MALAT1 chr11-65496994-65497909 #> 5 MALAT1 chr11-65569536-65570572 #> 6 MALAT1 chr11-65711306-65712797 dim(pairs_df) #> [1] 32296     2 scMultiMap_res <- scMultiMap(pbmc_cd14, pairs_df,                   gene_assay = 'RNA', # name of the gene assay                   peak_assay = 'peaks_ct') # name of the peak assay #> Start step 1: IRLS #> Start IRLS for RNA #> Start IRLS for peaks_ct #> Start step 2: WLS #> There are 1909 unique genes in the peak-gene pairs. #> scMultiMap elapsed time: 00:19 (mm:ss) head(scMultiMap_res) #>     gene                    peak       pval test_stat        covar      padj #> 1 MALAT1 chr11-65614961-65616132 0.90652298 0.1174254 1.743388e-09 0.9836402 #> 2 MALAT1 chr11-65918502-65920142 0.03734129 2.0820129 3.005705e-08 0.3367015 #> 3 MALAT1 chr11-65856895-65858482 0.26443486 1.1159703 1.604796e-08 0.7232544 #> 4 MALAT1 chr11-65496994-65497909 0.08524652 1.7210237 2.334859e-08 0.4901409 #> 5 MALAT1 chr11-65569536-65570572 0.18919341 1.3129690 1.776141e-08 0.6525889 #> 6 MALAT1 chr11-65711306-65712797 0.25426633 1.1400479 1.496624e-08 0.7139586 #>          cor #> 1 0.01180729 #> 2 0.16766414 #> 3 0.07195509 #> 4 0.15467261 #> 5 0.09259916 #> 6 0.09048044"},{"path":"https://changsubiostats.github.io/scMultiMap/articles/scMultiMap.html","id":"downstream-analysis-consistency-analysis","dir":"Articles","previous_headings":"2. PBMC example, 10x Multiome data","what":"2.3 Downstream analysis: consistency analysis","title":"scMultiMap","text":"demonstrate scMultiMap powerful identifying cell-type-specific enhancer-gene pairs, consider examples presented Figure~2b manuscript evaluate consistency (overlap) results scMultiMap promoter capture Hi-C (PCHiC). First, preprocess PCHiC data lift hg19 hg38 match genome version used 10x Multiome data (hg38).","code":"# Data required for liftover form hg19 to hg38 # from http://hgdownload.cse.ucsc.edu/goldenPath/hg19/liftOver/hg19ToHg38.over.chain.gz chain = import.chain(sprintf(\"%s/hg19ToHg38.over.chain\", data_dir)) # Obtain promoter capture Hi-C data from http://dx.doi.org/10.1016/j.cell.2016.09.037. # supplementary data \"DATA_S1/PCHiC_peak_matrix_cutoff5.tsv\"  PCHiC <- read.table(sprintf('%s/PCHiC_peak_matrix_cutoff5.tsv', data_dir), header = T) # focus on CD14 monocytes as denoted by the column 'Mon' PCHiC <- PCHiC[, c('oeChr', 'oeStart', 'oeEnd', # peak info                   'baitName', # gene name,                   'Mon')] # CHiCAGO scores for CD14 monocytes colnames(PCHiC)[1:3] <- c('chr', 'start', 'end') grange_hg19 <- GenomicRanges::makeGRangesFromDataFrame(df = PCHiC, keep.extra.columns = T) seqlevelsStyle(grange_hg19) = \"UCSC\" grange_hg38 <- rtracklayer::liftOver(grange_hg19, chain) grange_hg38 <- unlist(grange_hg38) genome(grange_hg38) = \"hg38\"  # significantly associated peak-gene pairs # defined by CHiCAGO scores >=5 (reference: http://dx.doi.org/10.1016/j.cell.2016.09.037) sig_assay_gr <- grange_hg38[grange_hg38@elementMetadata[['Mon']] > 5] sig_assay_gr$gene <- sig_assay_gr$baitName"},{"path":"https://changsubiostats.github.io/scMultiMap/articles/scMultiMap.html","id":"scmultimap","dir":"Articles","previous_headings":"2. PBMC example, 10x Multiome data > 2.3 Downstream analysis: consistency analysis","what":"scMultiMap","title":"scMultiMap","text":"evaluate overlap scMultiMap’s results.","code":"scMultiMap_overlap <- validate_with_assay(scMultiMap_res, sig_assay_gr, pvar = \"padj\", p_cutoff = 0.2) #> [1] \"p value from one-sided Fisher exact test: 5.39e-12, #overlap: 246, odds ratio: 1.74\""},{"path":"https://changsubiostats.github.io/scMultiMap/articles/scMultiMap.html","id":"signac","dir":"Articles","previous_headings":"2. PBMC example, 10x Multiome data > 2.3 Downstream analysis: consistency analysis","what":"Signac","title":"scMultiMap","text":"comparison, also evaluated Signac’s results.","code":"# By default, Signac uses normalized data to compute peak-gene associations pbmc_cd14 <- NormalizeData(object = pbmc_cd14) #####  ##### The code below could take 3 hours to run, as #####   (1) it consider all peaks instead of peaks with high abundance #####   (2) constructing the sampling-based null distribution is computationally intensive # Run Signac signac_res <- LinkPeaks(pbmc_cd14, 'peaks_ct', 'RNA',                         genes.use = unique(pairs_df$gene), # consider the same genes as above                         pvalue_cutoff = 1, score_cutoff = 0) # return the results on all pairs #   |++++++++++++++++++++++++++++++++++++++++++++++++++| 100% elapsed=03h 17m 21s ###### # Bug in Signac's p-value (01/2025): # the two-sided p-values are evaluated with only one tail of the Gaussian distribution # https://github.com/stuart-lab/signac/blob/8ecdde2/R/links.R#L481C29-L481C30 summary(Links(signac_res)$pvalue) # the maximum is smaller than 1 #>    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.  #>  0.0000  0.1167  0.2449  0.2449  0.3719  0.5000 # manually adjust this Links(signac_res)$pvalue <- 2*Links(signac_res)$pvalue  signac_res <- as.data.frame(Links(signac_res)) # consider the same set of peak-gene pairs as scMultiMap scMultiMap_res$pg <- paste(scMultiMap_res$peak, scMultiMap_res$gene, sep = ':') signac_res$pg <- paste(signac_res$peak, signac_res$gene, sep = ':') signac_res <- signac_res[match(scMultiMap_res$pg, signac_res$pg), ] # consistent with evaluating scMultiMap's result, we use BH procedure and set the significance cutoff to be 0.2 signac_res$padj <- p.adjust(signac_res$pvalue, method = 'BH') signac_overlap <- validate_with_assay(signac_res, sig_assay_gr, pvar = \"padj\", p_cutoff = 0.2) #> [1] \"p value from one-sided Fisher exact test: 7.61e-02, #overlap: 59, odds ratio: 1.23\""},{"path":"https://changsubiostats.github.io/scMultiMap/articles/scMultiMap.html","id":"scent","dir":"Articles","previous_headings":"2. PBMC example, 10x Multiome data > 2.3 Downstream analysis: consistency analysis","what":"SCENT","title":"scMultiMap","text":"evaluate SCENT, another method benchmarked scMultiMap’s manuscript, try code . Please note extremely computationally intensive due use boostrapping. Running codes took 17 hours, 34 minutes using 8 cores Intel(R) Xeon(R) Gold 6326 CPU @ 2.90GHz. high computational costs also demonstrated Figure 1c scMultiMap’s manuscript.","code":"# Tutorial for running SCENT: # https://github.com/immunogenomics/SCENT if (!requireNamespace(\"SCENT\", quietly = TRUE)) devtools::install_github(\"immunogenomics/SCENT\") library(SCENT) # extract count matrices peak_counts <- pbmc_cd14[['peaks_ct']]@counts[unique(pairs_df$peak),] rna_counts <- pbmc_cd14[['RNA']]@counts[unique(pairs_df$gene),] # construct metadata for cell-level covariates mdata <- pbmc_cd14@meta.data mdata$cell <- rownames(mdata) mdata$log_total_counts <- log(colSums(pbmc_cd14[['RNA']]@counts)) covariates_set <- \"log_total_counts\"  SCENT_obj <- CreateSCENTObj(rna = rna_counts, atac = peak_counts,                             meta.data = mdata,                             peak.info = pairs_df,                             covariates = covariates_set,                             celltypes = 'predicted.id') # column name for the cell type label in `mdata`  start_time <- Sys.time() SCENT_obj <- SCENT_algorithm(object = SCENT_obj, celltype = 'CD14 Mono',                             ncores=8, # for parallelism                              regr = 'poisson', bin = TRUE) # default end_time <- Sys.time()  SCENT.result <- SCENT_obj@SCENT.result  # print elapsed time elapsed <- difftime(end_time, start_time, units = \"secs\") message(sprintf(\"scMultiMap elapsed time: %02d:%02d (mm:ss)\\n\",               (as.integer(elapsed) %% 3600) %/% 60, # Minutes               as.integer(elapsed) %% 60))        # Seconds SCENT.result$padj <- p.adjust(SCENT.result$boot_basic_p, method = 'BH') SCENT_overlap <- validate_with_assay(SCENT.result, sig_assay_gr, pvar = \"padj\", p_cutoff = 0.2) #> [1] \"p value from one-sided Fisher exact test: 5.77e-01, #overlap: 149, odds ratio: 0.98\""},{"path":"https://changsubiostats.github.io/scMultiMap/articles/scMultiMap.html","id":"summary-of-comparison","dir":"Articles","previous_headings":"2. PBMC example, 10x Multiome data > 2.3 Downstream analysis: consistency analysis","what":"Summary of comparison","title":"scMultiMap","text":"example, scMultiMap identified 246 pairs overlapped PCHiC data CD14 monocytes, Signac SCENT identified 59 149 pairs, respectively. Moreover, scMultiMap also gave highest enrichment (odds ratio=1.74) compared Signac (1.23) SCENT (0.98). particular, SCENT odds ratio smaller 1, potentially due large number false positive discoveries consistent PCHiC. one example demonstrates improved performance scMultiMap compared existing methods. Please refer scMultiMap’s manuscript examples, including additional consistency analysis orthogonal assays, reproducibility analysis across independent single-cell multimodal datasets, systematic evaluation type error power. Note numerical results (.e., numbers reproduced pairs odds ratio) presented differ slightly paper, published analysis combined four single-cell Multiome PBMC datasets increase power (see Methods manuscript). However, overall conclusions regarding comparison across methods remain unchanged.","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/articles/scMultiMap.html","id":"more-vignettes","dir":"Articles","previous_headings":"","what":"More vignettes","title":"scMultiMap","text":"Please visit vignettes: scMultiMap disease-control studies scMultiMap integrative analysis GWAS results interested examples analysis scMultiMap!","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Chang Su. Author, maintainer.","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Su C (2025). scMultiMap: Cell-type-specific mapping enhancer target genes single-cell multimodal data scMultiMap. R package version 0.9.1, https://changsubiostats.github.io/scMultiMap/.","code":"@Manual{,   title = {scMultiMap: Cell-type-specific mapping of enhancer and target genes from single-cell multimodal data with scMultiMap},   author = {Chang Su},   year = {2025},   note = {R package version 0.9.1},   url = {https://changsubiostats.github.io/scMultiMap/}, }"},{"path":"https://changsubiostats.github.io/scMultiMap/index.html","id":"scmultimap","dir":"","previous_headings":"","what":"Cell-type-specific mapping of enhancer and target genes from single-cell multimodal data with scMultiMap","title":"Cell-type-specific mapping of enhancer and target genes from single-cell multimodal data with scMultiMap","text":"scMultiMap R package inferring cell-type-specific peak-gene association single-cell multimodal data. provides implementation statistical method scMultiMap proposed manuscript: https://www.biorxiv.org/content/10.1101/2024.09.24.614814v1.","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"Cell-type-specific mapping of enhancer and target genes from single-cell multimodal data with scMultiMap","text":"scMultiMap available GitHub. can install using","code":"## Load devtools for installing R packages from Github library(devtools) ## Install CS-CORE from Github install_github(\"ChangSuBiostats/scMultiMap\")"},{"path":"https://changsubiostats.github.io/scMultiMap/index.html","id":"vignettes","dir":"","previous_headings":"","what":"Vignettes","title":"Cell-type-specific mapping of enhancer and target genes from single-cell multimodal data with scMultiMap","text":"vignette shows basic example using scMultiMap inferring peak-gene associations cell types using 10x multiome data PBMC. vignettes package currently active development. examples coming soon!","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/index.html","id":"contact-us","dir":"","previous_headings":"","what":"Contact us","title":"Cell-type-specific mapping of enhancer and target genes from single-cell multimodal data with scMultiMap","text":"Chang Su, chang.su@emory.edu","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/index.html","id":"reference-and-news","dir":"","previous_headings":"","what":"Reference and news","title":"Cell-type-specific mapping of enhancer and target genes from single-cell multimodal data with scMultiMap","text":"Cell-type-specific mapping enhancer target genes single-cell multimodal data. Chang Su, Dongsoo Lee, Peng Jin Jingfei Zhang. 2024. https://www.biorxiv.org/content/10.1101/2024.09.24.614814v1","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/reference/CollapseToLongestTranscript.html","id":null,"dir":"Reference","previous_headings":"","what":"CollapseToLongestTranscript — CollapseToLongestTranscript","title":"CollapseToLongestTranscript — CollapseToLongestTranscript","text":"Obtain gene coordinates, duplicate Signac:::CollapseToLongestTranscript Signac 1.14.0","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/reference/CollapseToLongestTranscript.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"CollapseToLongestTranscript — CollapseToLongestTranscript","text":"","code":"CollapseToLongestTranscript(ranges)"},{"path":"https://changsubiostats.github.io/scMultiMap/reference/CollapseToLongestTranscript.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"CollapseToLongestTranscript — CollapseToLongestTranscript","text":"ranges Signac annotation","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/reference/CollapseToLongestTranscript.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"CollapseToLongestTranscript — CollapseToLongestTranscript","text":"grange object gene coordinates","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/reference/DistanceToTSS.html","id":null,"dir":"Reference","previous_headings":"","what":"Find peaks near genes — DistanceToTSS","title":"Find peaks near genes — DistanceToTSS","text":"Find peaks within given distance threshold gene duplicate Signac:::DistanceToTSS Signac 1.14.0","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/reference/DistanceToTSS.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Find peaks near genes — DistanceToTSS","text":"","code":"DistanceToTSS(peaks, genes, distance = 2e+05, sep = c(\"-\", \"-\"))"},{"path":"https://changsubiostats.github.io/scMultiMap/reference/DistanceToTSS.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Find peaks near genes — DistanceToTSS","text":"peaks GRanges object containing peak coordinates genes GRanges object containing gene coordinates distance Distance threshold. Peaks within distance gene recorded. sep Separator peak names creating results matrix","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/reference/DistanceToTSS.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Find peaks near genes — DistanceToTSS","text":"Returns sparse matrix","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/reference/example_pair.html","id":null,"dir":"Reference","previous_headings":"","what":"A simulated independent peak-gene pair — example_pair","title":"A simulated independent peak-gene pair — example_pair","text":"data set created illustrative purposes used test scMultiMap_IRLS() scMultiMap_WLS(). source code generating data set data-raw/ Github.","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/reference/example_pair.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"A simulated independent peak-gene pair — example_pair","text":"","code":"example_pair"},{"path":[]},{"path":"https://changsubiostats.github.io/scMultiMap/reference/example_pair.html","id":"example-pair","dir":"Reference","previous_headings":"","what":"example_pair","title":"A simulated independent peak-gene pair — example_pair","text":"Two lists (one named 'gene' named 'peak'), 2 elements: counts length 2000 vector gene/peak counts seq_depths length 2000 vector sequencing depths scRNA-seq/scATAC-seq","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/reference/example_pair_bsample.html","id":null,"dir":"Reference","previous_headings":"","what":"A simulated perfectly correlated peak-gene pair with multiple biological samples present — example_pair_bsample","title":"A simulated perfectly correlated peak-gene pair with multiple biological samples present — example_pair_bsample","text":"data set created illustrative purposes used test scMultiMap_IRLS() scMultiMap_WLS(). source code generating data set data-raw/ Github.","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/reference/example_pair_bsample.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"A simulated perfectly correlated peak-gene pair with multiple biological samples present — example_pair_bsample","text":"","code":"example_pair_bsample"},{"path":[]},{"path":"https://changsubiostats.github.io/scMultiMap/reference/example_pair_bsample.html","id":"example-pair-bsample","dir":"Reference","previous_headings":"","what":"example_pair_bsample","title":"A simulated perfectly correlated peak-gene pair with multiple biological samples present — example_pair_bsample","text":"Three lists: first two list named 'gene' 'peak' respectively, 2 elements: counts length 2000 vector gene/peak counts seq_depths length 2000 vector sequencing depths scRNA-seq/scATAC-seq , third list named 'bsample' hosts length n vector sample labels","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/reference/get_top_peak_gene_pairs.html","id":null,"dir":"Reference","previous_headings":"","what":"get_top_peak_gene_pairs — get_top_peak_gene_pairs","title":"get_top_peak_gene_pairs — get_top_peak_gene_pairs","text":"peaks genes high abundance, construct candidate pairs peaks close proximity gene.","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/reference/get_top_peak_gene_pairs.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"get_top_peak_gene_pairs — get_top_peak_gene_pairs","text":"","code":"get_top_peak_gene_pairs(   obj,   gene_top = 2000,   peak_top = 20000,   distance = 5e+05,   gene_assay = \"RNA\",   peak_assay = \"peak\" )"},{"path":"https://changsubiostats.github.io/scMultiMap/reference/get_top_peak_gene_pairs.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"get_top_peak_gene_pairs — get_top_peak_gene_pairs","text":"obj Seurat object single-cell multimodal data. gene_top Number top highly expressed genes. Default 2000. peak_top Number top highly accessible peaks. Default 20000. distance Distance threshold peaks considered possibly associated genes. Default 5e+05. gene_assay Name gene assay Seurat object. Default 'RNA'. peak_assay Name peak assay Seurat object. Default 'peak'.","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/reference/get_top_peak_gene_pairs.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"get_top_peak_gene_pairs — get_top_peak_gene_pairs","text":"data frame candidate peak-gene pairs. gene gene peak-gene pair peak peak peak-gene pair","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/reference/make_gene_to_peak_link.html","id":null,"dir":"Reference","previous_headings":"","what":"make_gene_to_peak_link — make_gene_to_peak_link","title":"make_gene_to_peak_link — make_gene_to_peak_link","text":"make data frame links peak given gene input Signac::LinkPlot()","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/reference/make_gene_to_peak_link.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"make_gene_to_peak_link — make_gene_to_peak_link","text":"","code":"make_gene_to_peak_link(df, gene, obj, peak_assay = \"peak\")"},{"path":"https://changsubiostats.github.io/scMultiMap/reference/make_gene_to_peak_link.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"make_gene_to_peak_link — make_gene_to_peak_link","text":"df data frame peak-gene associations results, containing columns gene, peak, pvar (see ). gene Character, gene interest. obj Seurat object contains data gene peaks. peak_assay Name peak assay. Default 'peak'.","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/reference/make_gene_to_peak_link.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"make_gene_to_peak_link — make_gene_to_peak_link","text":"grange object genomic ranges corresponding gene peak, following metadata: score correlation peak-gene association results gene gene name peak peak name test_stat test statistics peak-gene association results` pval p-value peak-gene association results","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/reference/scMultiMap.html","id":null,"dir":"Reference","previous_headings":"","what":"scMultiMap — scMultiMap","title":"scMultiMap — scMultiMap","text":"Run scMultiMap infer cell-type-specific peak-gene associations.","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/reference/scMultiMap.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"scMultiMap — scMultiMap","text":"","code":"scMultiMap(   obj,   pairs_df,   bsample = NULL,   gene_assay = \"RNA\",   peak_assay = \"peak\",   seq_depth_list = NULL,   p.adjust.method = \"BH\",   irls = T,   verbose = F )"},{"path":"https://changsubiostats.github.io/scMultiMap/reference/scMultiMap.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"scMultiMap — scMultiMap","text":"Cell-type-specific mapping enhancer target genes single-cell multimodal data. Chang Su, Dongsoo Lee, Peng Jin, Jingfei Zhang; https://www.biorxiv.org/content/10.1101/2024.09.24.614814v1","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/reference/scMultiMap.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"scMultiMap — scMultiMap","text":"obj Seurat object single-cell multimodal data. pairs_df data frame peak-gene pairs evaluate. first column gene name, second column peak name. bsample Default NULL cells biological sample. multiple biological samples present, bsample either column name sample label Seurat object meta data, length n vector labels biological samples. gene_assay Name gene assay Seurat object. Default 'RNA'. peak_assay Name peak assay Seurat object. Default 'peak'. seq_depth_list list two length n vectors sequencing depths. NULL, calculated total number gene/peak counts cell two modalities, respectively. p.adjust.method Method multiple testing adjustment, passed stats::p.adjust. Default 'BH' FDR control. irls Whether run IRLS estimate mean variance parameters step 1. Default TRUE. verbose Whether print detailed messages. Default FALSE.","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/reference/scMultiMap.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"scMultiMap — scMultiMap","text":"data frame scMultiMap results six columns. gene gene peak-gene pair peak peak peak-gene pair pval p-value test_stat test statistics covar estimated covariance cor estimated correlation row corresponds one peak-gene pair's results scMultiMap. pval test_stat denote statistical significance peak-gene association, covar denote magnitude association. number rows equal number pairs pairs_df present Seurat object.","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/reference/scMultiMap.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"scMultiMap — scMultiMap","text":"","code":"# For illustrative purposes, we provide # a toy Seurat object `small_obj` and # a data frame of candidate peak-gene pairs `small_pairs_df` # in this R package. res <- scMultiMap(small_obj, small_pairs_df) #> Loading required package: SeuratObject #> Loading required package: sp #> ‘SeuratObject’ was built under R 4.4.0 but the current version is #> 4.4.2; it is recomended that you reinstall ‘SeuratObject’ as the ABI #> for R may have changed #>  #> Attaching package: ‘SeuratObject’ #> The following objects are masked from ‘package:base’: #>  #>     intersect, t #> Start step 1: IRLS #> Start IRLS for RNA #> Start IRLS for peak #> Start step 2: WLS #> There are 10 unique genes in the peak-gene pairs. #> scMultiMap elapsed time: 00:01 (mm:ss) head(res,2) #>     gene                    peak      pval test_stat        covar      padj #> 1 MALAT1 chr11-65013281-65014841 0.1521555 1.4319591 3.100282e-05 0.8273097 #> 2 MALAT1 chr11-65026934-65027962 0.7938414 0.2613256 5.204042e-06 0.9753992 #>        cor #> 1 0.000000 #> 2 0.102161 #    gene                    peak      pval test_stat        covar # 1 MALAT1 chr11-65013281-65014841 0.1521555 1.4319591 3.100282e-05 # 2 MALAT1 chr11-65026934-65027962 0.7938414 0.2613256 5.204042e-06"},{"path":"https://changsubiostats.github.io/scMultiMap/reference/scMultiMap_IRLS.html","id":null,"dir":"Reference","previous_headings":"","what":"Iteratively reweighted least squares (IRLS) in scMultiMap — scMultiMap_IRLS","title":"Iteratively reweighted least squares (IRLS) in scMultiMap — scMultiMap_IRLS","text":"function implements 1st step scMultiMap: estimate mean variance peaks genes IRLS. output used input 2nd step, scMultiMap_WLS(), estimate infer association genes peaks.","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/reference/scMultiMap_IRLS.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Iteratively reweighted least squares (IRLS) in scMultiMap — scMultiMap_IRLS","text":"","code":"scMultiMap_IRLS(X, seq_depth, bsample = NULL, irls = T, verbose = F)"},{"path":"https://changsubiostats.github.io/scMultiMap/reference/scMultiMap_IRLS.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"Iteratively reweighted least squares (IRLS) in scMultiMap — scMultiMap_IRLS","text":"Cell-type-specific mapping enhancer target genes single-cell multimodal data. Chang Su, Dongsoo Lee, Peng Jin, Jingfei Zhang; https://www.biorxiv.org/content/10.1101/2024.09.24.614814v1","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/reference/scMultiMap_IRLS.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Iteratively reweighted least squares (IRLS) in scMultiMap — scMultiMap_IRLS","text":"X n p count matrix, n denotes number cells p denotes number genes/peaks. can length p vector n=1. seq_depth length n vector sequencing depths bsample length n vector names biological sample cell . cells sample, set NULL (Default). irls Whether use IRLS. Default TRUE. FALSE, use ordinary least squares. verbose Whether print detailed messages. Default FALSE.","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/reference/scMultiMap_IRLS.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Iteratively reweighted least squares (IRLS) in scMultiMap — scMultiMap_IRLS","text":"list two length p vectors: mu estimated mean sigma_sq estimated variance","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/reference/scMultiMap_IRLS.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Iteratively reweighted least squares (IRLS) in scMultiMap — scMultiMap_IRLS","text":"","code":"# The following codes illustrate the use of `scMultiMap_IRLS` with toy datasets # `small_obj` provided in this R package. irls_list <- list() irls_list[['gene']] <- scMultiMap_IRLS(t(as.matrix(small_obj[['RNA']]$counts)),  Matrix::colSums(small_obj[['RNA']]$counts)) irls_list[['peak']] <- scMultiMap_IRLS(t(as.matrix(small_obj[['peak']]$counts)),  Matrix::colSums(small_obj[['peak']]$counts)) print(str(irls_list[['gene']])) # estimated mean and variance for genes #> List of 3 #>  $ mu      : Named num [1:100] 0.1273 0.0341 0.0241 0.0241 0.0216 ... #>   ..- attr(*, \"names\")= chr [1:100] \"MALAT1\" \"LYZ\" \"B2M\" \"ACTB\" ... #>  $ sigma_sq: Named num [1:100] 1.57e-03 2.05e-04 5.67e-05 7.81e-05 2.00e-04 ... #>   ..- attr(*, \"names\")= chr [1:100] \"MALAT1\" \"LYZ\" \"B2M\" \"ACTB\" ... #>  $ theta   : num 5.05 #> NULL print(str(irls_list[['peak']])) # estimated mean and variance for peaks #> List of 3 #>  $ mu      : Named num [1:250] 0.00559 0.00359 0.00423 0.00436 0.00282 ... #>   ..- attr(*, \"names\")= chr [1:250] \"chr11-65013281-65014841\" \"chr11-65026934-65027962\" \"chr11-65040583-65041780\" \"chr11-65083457-65084665\" ... #>  $ sigma_sq: Named num [1:250] -5.06e-06 1.65e-06 5.43e-07 3.94e-06 3.56e-06 ... #>   ..- attr(*, \"names\")= chr [1:250] \"chr11-65013281-65014841\" \"chr11-65026934-65027962\" \"chr11-65040583-65041780\" \"chr11-65083457-65084665\" ... #>  $ theta   : num 4.1 #> NULL"},{"path":"https://changsubiostats.github.io/scMultiMap/reference/scMultiMap_WLS.html","id":null,"dir":"Reference","previous_headings":"","what":"Weighted least squares (WLS) in scMultiMap — scMultiMap_WLS","title":"Weighted least squares (WLS) in scMultiMap — scMultiMap_WLS","text":"function implements 2nd step scMultiMap: estimate infer peak-gene association WLS. takes output 1st step, scMultiMap_IRLS input.","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/reference/scMultiMap_WLS.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Weighted least squares (WLS) in scMultiMap — scMultiMap_WLS","text":"","code":"scMultiMap_WLS(count_list, seq_depth_list, pairs_df, irls_list, verbose = F)"},{"path":"https://changsubiostats.github.io/scMultiMap/reference/scMultiMap_WLS.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"Weighted least squares (WLS) in scMultiMap — scMultiMap_WLS","text":"Cell-type-specific mapping enhancer target genes single-cell multimodal data. Chang Su, Dongsoo Lee, Peng Jin, Jingfei Zhang; https://www.biorxiv.org/content/10.1101/2024.09.24.614814v1","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/reference/scMultiMap_WLS.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Weighted least squares (WLS) in scMultiMap — scMultiMap_WLS","text":"count_list list two p n count matrices. first element gene second peak. seq_depth_list list two length p vectors sequencing depths. first element scRNA-seq second scATAC-seq. pairs_df data frame candidate peak-gene pairs evaluate. first column gene name, second peak name. irls_list list two lists generated 1st step scMultiMap, .e. scMultiMap_IRLS. first list contains results genes, second peaks. verbose Whether print detailed messages. Default FALSE.","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/reference/scMultiMap_WLS.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Weighted least squares (WLS) in scMultiMap — scMultiMap_WLS","text":"data.frame five columns gene gene peak-gene pair peak peak peak-gene pair pval p-value test_stat test statistics covar estimated covariance row corresponds one peak-gene pair's results scMultiMap. pval test_stat denote statistical significance peak-gene association, covar denote magnitude association. number rows equal number pairs pairs_df present Seurat object.","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/reference/scMultiMap_WLS.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Weighted least squares (WLS) in scMultiMap — scMultiMap_WLS","text":"","code":"count_list <- list(gene = t(as.matrix(small_obj[['RNA']]$counts)),  peak = t(as.matrix(small_obj[['peak']]$counts))) seq_depth_list <- list(gene = Matrix::colSums(small_obj[['RNA']]$counts),  peak = Matrix::colSums(small_obj[['peak']]$counts)) wls_res <- scMultiMap_WLS(count_list, seq_depth_list, small_pairs_df, small_irls_list) #> There are 10 unique genes in the peak-gene pairs."},{"path":"https://changsubiostats.github.io/scMultiMap/reference/scMultiMap_WLS_by_gene.html","id":null,"dir":"Reference","previous_headings":"","what":"WLS utility function. — scMultiMap_WLS_by_gene","title":"WLS utility function. — scMultiMap_WLS_by_gene","text":"function performs WLS one gene peaks candidate pairs.","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/reference/scMultiMap_WLS_by_gene.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"WLS utility function. — scMultiMap_WLS_by_gene","text":"","code":"scMultiMap_WLS_by_gene(   x_gene,   X_peak,   m_gene,   M_peak,   w_gene,   W_peak,   var_gene,   Var_peak,   gene_seq_depth,   peak_seq_depth )"},{"path":"https://changsubiostats.github.io/scMultiMap/reference/scMultiMap_WLS_by_gene.html","id":"source","dir":"Reference","previous_headings":"","what":"Source","title":"WLS utility function. — scMultiMap_WLS_by_gene","text":"Cell-type-specific mapping enhancer target genes single-cell multimodal data. Chang Su, Dongsoo Lee, Peng Jin, Jingfei Zhang;","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/reference/scMultiMap_WLS_by_gene.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"WLS utility function. — scMultiMap_WLS_by_gene","text":"x_gene length n vector gene counts. n denotes number cells. X_peak n p peak count matrix. p denotes number peaks. m_gene length n vector gene counts' mean across cells. M_peak n p matrix peak counts' mean across cells peaks. w_gene length n vector used calculate regression weights. W_peak n p matrix used calculate regression weights. var_gene length n vector gene counts' variance across cells. Var_peak n p matrix peak counts' variance across cells peaks. gene_seq_depth length n vector sequencing depths RNA modality. peak_seq_depth length n vector sequencing depths ATAC/peak modality.","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/reference/scMultiMap_WLS_by_gene.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"WLS utility function. — scMultiMap_WLS_by_gene","text":"data.frame p rows three columns pval p-value test_stat test statistics covar estimated covariance row correspond scMultiMap's WLS result one gene-peak pair.","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/reference/small_irls_list.html","id":null,"dir":"Reference","previous_headings":"","what":"A toy example of estimated results from scMultiMap_IRLS() on small_obj. — small_irls_list","title":"A toy example of estimated results from scMultiMap_IRLS() on small_obj. — small_irls_list","text":"source code generating data set data-raw/ Github.","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/reference/small_irls_list.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"A toy example of estimated results from scMultiMap_IRLS() on small_obj. — small_irls_list","text":"","code":"small_irls_list"},{"path":[]},{"path":"https://changsubiostats.github.io/scMultiMap/reference/small_irls_list.html","id":"small-irls-list","dir":"Reference","previous_headings":"","what":"small_irls_list","title":"A toy example of estimated results from scMultiMap_IRLS() on small_obj. — small_irls_list","text":"list two lists generated 1st step scMultiMap gene scMultiMap_IRLS results genes peak scMultiMap_IRLS results peaks","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/reference/small_obj.html","id":null,"dir":"Reference","previous_headings":"","what":"A small pedagogical Seurat object — small_obj","title":"A small pedagogical Seurat object — small_obj","text":"Seurat object created illustrative purposes used test scMultiMap(). source code generating data set data-raw/ Github.","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/reference/small_obj.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"A small pedagogical Seurat object — small_obj","text":"","code":"small_obj"},{"path":[]},{"path":"https://changsubiostats.github.io/scMultiMap/reference/small_obj.html","id":"small-obj","dir":"Reference","previous_headings":"","what":"small_obj","title":"A small pedagogical Seurat object — small_obj","text":"Seurat object 100 cells two assay RNA gene count matrix 100 genes 100 cells peak peak count matrix 250 genes 100 cells","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/reference/small_pairs_df.html","id":null,"dir":"Reference","previous_headings":"","what":"A data frame of peak-gene pairs, to be used with small_obj — small_pairs_df","title":"A data frame of peak-gene pairs, to be used with small_obj — small_pairs_df","text":"data frame holds candidate peak-gene pairs inferred scMultiMap() small_obj. source code generating data set data-raw/ Github.","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/reference/small_pairs_df.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"A data frame of peak-gene pairs, to be used with small_obj — small_pairs_df","text":"","code":"small_pairs_df"},{"path":[]},{"path":"https://changsubiostats.github.io/scMultiMap/reference/small_pairs_df.html","id":"small-pairs-df","dir":"Reference","previous_headings":"","what":"small_pairs_df","title":"A data frame of peak-gene pairs, to be used with small_obj — small_pairs_df","text":"data frame 250 rows (peak-gene pairs) 2 columns gene gene name peak peak name","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/reference/validate_with_assay.html","id":null,"dir":"Reference","previous_headings":"","what":"validate_with_assay — validate_with_assay","title":"validate_with_assay — validate_with_assay","text":"Validate peak-gene associations computed single-cell multimodal data evaluating consistency orthogonal assay.","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/reference/validate_with_assay.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"validate_with_assay — validate_with_assay","text":"","code":"validate_with_assay(res_df, sig_assay_gr, pvar = \"padj\", p_cutoff = 0.2)"},{"path":"https://changsubiostats.github.io/scMultiMap/reference/validate_with_assay.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"validate_with_assay — validate_with_assay","text":"res_df data frame peak-gene associations results, containing columns gene, peak, pvar (see ). sig_assay_gr GRanges object associated peak-gene pairs orthogonal assays, containing gene column metadata pvar variable res_df use claiming significant associations. Default 'padj'. p_cutoff Cutoff significance based pvar. Default 0.2.","code":""},{"path":"https://changsubiostats.github.io/scMultiMap/reference/validate_with_assay.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"validate_with_assay — validate_with_assay","text":"named numeric vector summarizes overlap res_df results sig_assay_gr results pval p value one-sided Fisher exact test n_overlap numebr overlapped peak-gene pairs oddsratio odds ratio two--two table ratio overlapped pairs among significant pairs res_df enr enrichment overlapped pairs among significant pairs compared background pairs","code":""}]
